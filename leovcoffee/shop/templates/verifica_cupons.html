{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeoV Coffee - Meu Carrinho </title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/confirmar_pedido.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'images/icon.ico' %}">

</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <header>
    <nav class="navbar navbar-dark bg-dark fixed-top" style = "box-shadow: 1px 2px 10px rgb(51, 51, 51);">
        <div class="container-fluid">
          <a class="navbar-brand px-1 mt-2 mb-2" href="http://127.0.0.1:8000/" ><img src="{%static 'images/leov_logo_nav.png'%}" width = 80% alt="Logo SkyBards"></a>
          <ul class="navbar-nav ms-auto">
            <!-- Badge -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'carrinho' %}">
                <span class="badge badge-pill bg-danger"> {{ itensCarrinho }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cart2 mr-5 " viewBox="0 0 16 16">
                  <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l1.25 5h8.22l1.25-5H3.14zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
                </svg>
              </a>
            </li>
          </ul>
          <button class="navbar-toggler-icon mr-2 " type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation"></button>
          <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu de Navegação</h5>
              <button type="button" class="btn-close bg-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="avatar_user d-grid gap-5 d-md-flex mx-auto mt-5">
              {% if user.is_authenticated %}
                <a href="{% url 'minhaConta' %}"><img src="{%static 'images/avatar_user.png'%}" class="rounded-circle" style="width: 90%;"
                  alt="User" /> </a>
              {% else %}
                <a href="{% url 'userLogin' %}"><img src="{%static 'images/avatar_user.png'%}" class="rounded-circle" style="width: 90%;"
                  alt="User" /> </a>
              {% endif %}
            </div>
            <a class="nav-link mx-auto" href="{% url 'minhaConta' %}">
              {% if user.is_authenticated %}
                <p class = "ml-4"> Olá, {{ user.username }}</p>
                <p class="text-bg-primary rounded p-1"> Acessar minha conta </p>
              {% else %}
                <a class="nav-link mx-auto mt-1" href="auth/login"><p> Faça o login </p></a>
              {% endif %} </a>


            </a>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 text-center fs-5 mt-5 ">
                <li class="nav-item">
                  <a class="nav-link" aria-current="page" href="/">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" href="{% url 'produtos' %}">Shop</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/contato.html">Contato</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/sobre.html">Sobre</a>
                </li>
                <form class="mx-1 mx-md-4" action="{% url 'userLogout' %}" method="POST">
                  {% csrf_token %}

                  <button class = button_logout>
                  <li class="nav-item">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 15 15">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                      </svg>
                  </li>
                </button>
                </form>
                <img class = "mx-5" src="{%static 'images/letter_leov_home.png'%}" width = 80% alt="Logo JunVie">
            </div>
          </div>
        </div>
      </nav>
  </header>

  <div class="container text-white">
    <div class="py-5 text-center text-white">
      <p class="lead mt-5">Selecione o endereço de entrega deste pedido</p>
    </div>
  
    <div class="row">
      <div class="col-md-4 order-md-2 mb-4">
        <h4 class="d-flex justify-content-between align-items-center mb-3">
          <span >Seu carrinho</span>
          <span class="badge badge-secondary badge-pill"> {{ itensCarrinho }}</span>
        </h4>
        {% for item in itens %}
        <ul class="list-group mb-3">
          <li class="list-group-item d-flex justify-content-between lh-condensed">
            <div>
              <h6 class="my-0"> {{ item.quantidade }}x {{ item.produto.nome }}</h6>
              <!--- <small class="text-muted"> OBS: </small> -->
            </div>
            <span class="text-muted"> {{ item.total_item }}</span>
          </li>
        {% endfor %}
          <li class="list-group-item d-flex justify-content-between bg-light">
            <div class="text-success">
              <h6 class="my-0">Código do Cupom</h6>
              <small> {{ codigo_cupom }} </small>
            </div>
            <span class="text-success"> - R$ {{ valor_desconto }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total</span>
            <strong> R$ {{ valor_total_com_desconto }}</strong>
          </li>
        </ul>
  
        <form class="card p-2" method = "POST" action= "{% url 'verificaCupons' %}">
          {% csrf_token %}
          <div class="input-group">
            <input type="text" name= "input_buscar_cupom" class="form-control" placeholder="Código do Cupom">
            <div class="input-group-append">
              <button type="submit" class="btn btn-secondary">Aplicar</button>
            </div>
          </div>
        </form>
      </div>
      <div class="col-md-8 order-md-1">
          <div class="row">
            <div id="info-envio" class="d-block my-3">
            <div class="col-md-5 mb-3">
            <form method="POST" action="{% url 'pagamentoPedido' %}">
              {% csrf_token %}
              <label for="country">Meus endereços</label>
              <select class="custom-select d-block w-100" id="enderecos" name="endereco_entrega">
                <option value="">Selecione uma opção</option> 
              {% for i in endereco_entrega %} 
                <option value="{{ i.logradouro }}, {{ i.numero }}, {{ i.complemento }} - {{ i.bairro }}"> {{ i.logradouro }}, {{ i.numero }}, {{ i.complemento }} - {{ i.bairro }} </option>
              {% endfor %}
              </select>
              <input
              class="form-check-input ml-1 mt-2"
              type="checkbox"
              value="Retirar no local"
              name = "checkbox_retirar_pedido"
              id="condition-checkbox"/>
              <label
                class="form-check-label text-white small ml-4 mt-2 d-block"
                for="condition-checkbox"> Retirar no local </label>
              <a href="{% url 'minhaConta' %}"> <button type="button" class="btn btn-secondary mt-3"> + Cadastrar endereço</button> </a>
            </div>
            </div>
          </div>
          <hr class="mb-4"> 
          <!-- <input id="form-button" class="btn btn-primary btn-lg btn-block" type="submit" value="Continuar"> -->
        <div id="info-pagamento1" class="d-block my-3">
            <h4 class="mb-3">Forma de Pagamento</h4>
          <div class="d-block my-3">
              <input
              class="form-check-input ml-1"
              type="checkbox"
              value="Cartão de Crédito / Débito"
              name = "checkbox_meio_pagamento"
              id="condition-checkbox"/>
            <label
              class="form-check-label text-white small ml-4"
              for="condition-checkbox"> Cartão de Crédito / Débito </label>
          </div>
            <input
            class="form-check-input ml-1"
            type="checkbox"
            value="Pix"
            name = "checkbox_meio_pagamento"
            id="condition-checkbox"/>
              <label
                class="form-check-label text-white small ml-4"
                for="condition-checkbox"> Pix </label>
              </div>
      </div>
    </div>
    <div class="d-block my-3">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="cc-name">Nome no cartão</label>
          <input type="text" class="form-control" id="cc-name" name="input_cc-name"  maxlength="100">
          <small class="text-muted">Nome completo descrito no cartão</small>
      </div>
      <div class="col-md-6 mb-3">
        <label for="cc-number">Número do cartão</label>
        <input type="text" class="form-control cc-number-input w-50" id="cc-number" name="input_cc-number"  maxlength="19">
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 mb-3">
        <label for="cc-expiration">Data de validade</label>
        <input type="text" class="form-control cc-expiry-input" id="cc-expiration" name="input_cc-expiration"  maxlength="5">
      </div>
      <div class="col-md-3 mb-3">
        <label for="cc-expiration">CVV</label>
        <input type="text" class="form-control cc-cvc-input" id="cc-cvv" name="input_cc-cvv"  maxlength="3">
      </div>
    </div>
    <hr class="mb-4">
    <button class="btn btn-primary btn-lg btn-block" type="submit">Finalizar Pedido</button>
  </form>
</div>
</div>
  
    
</body>
<script>
  let ccNumberInput = document.querySelector('.cc-number-input'),
		ccNumberPattern = /^\d{0,16}$/g,
		ccNumberSeparator = " ",
		ccNumberInputOldValue,
		ccNumberInputOldCursor,
		
		ccExpiryInput = document.querySelector('.cc-expiry-input'),
		ccExpiryPattern = /^\d{0,4}$/g,
		ccExpirySeparator = "/",
		ccExpiryInputOldValue,
		ccExpiryInputOldCursor,
		
		ccCVCInput = document.querySelector('.cc-cvc-input'),
		ccCVCPattern = /^\d{0,3}$/g,
		
		mask = (value, limit, separator) => {
			var output = [];
			for (let i = 0; i < value.length; i++) {
				if ( i !== 0 && i % limit === 0) {
					output.push(separator);
				}
				
				output.push(value[i]);
			}
			
			return output.join("");
		},
		unmask = (value) => value.replace(/[^\d]/g, ''),
		checkSeparator = (position, interval) => Math.floor(position / (interval + 1)),
		ccNumberInputKeyDownHandler = (e) => {
			let el = e.target;
			ccNumberInputOldValue = el.value;
			ccNumberInputOldCursor = el.selectionEnd;
		},
		ccNumberInputInputHandler = (e) => {
			let el = e.target,
					newValue = unmask(el.value),
					newCursorPosition;
			
			if ( newValue.match(ccNumberPattern) ) {
				newValue = mask(newValue, 4, ccNumberSeparator);
				
				newCursorPosition = 
					ccNumberInputOldCursor - checkSeparator(ccNumberInputOldCursor, 4) + 
					checkSeparator(ccNumberInputOldCursor + (newValue.length - ccNumberInputOldValue.length), 4) + 
					(unmask(newValue).length - unmask(ccNumberInputOldValue).length);
				
				el.value = (newValue !== "") ? newValue : "";
			} else {
				el.value = ccNumberInputOldValue;
				newCursorPosition = ccNumberInputOldCursor;
			}
			
			el.setSelectionRange(newCursorPosition, newCursorPosition);
			
			highlightCC(el.value);
		},
		highlightCC = (ccValue) => {
			let ccCardType = '',
					ccCardTypePatterns = {
						amex: /^3/,
						visa: /^4/,
						mastercard: /^5/,
						disc: /^6/,
						
						genric: /(^1|^2|^7|^8|^9|^0)/,
					};
			
			for (const cardType in ccCardTypePatterns) {
				if ( ccCardTypePatterns[cardType].test(ccValue) ) {
					ccCardType = cardType;
					break;
				}
			}
			
			let activeCC = document.querySelector('.cc-types__img--active'),
					newActiveCC = document.querySelector(`.cc-types__img--${ccCardType}`);
			
			if (activeCC) activeCC.classList.remove('cc-types__img--active');
			if (newActiveCC) newActiveCC.classList.add('cc-types__img--active');
		},
		ccExpiryInputKeyDownHandler = (e) => {
			let el = e.target;
			ccExpiryInputOldValue = el.value;
			ccExpiryInputOldCursor = el.selectionEnd;
		},
		ccExpiryInputInputHandler = (e) => {
			let el = e.target,
					newValue = el.value;
			
			newValue = unmask(newValue);
			if ( newValue.match(ccExpiryPattern) ) {
				newValue = mask(newValue, 2, ccExpirySeparator);
				el.value = newValue;
			} else {
				el.value = ccExpiryInputOldValue;
			}
		};

ccNumberInput.addEventListener('keydown', ccNumberInputKeyDownHandler);
ccNumberInput.addEventListener('input', ccNumberInputInputHandler);

ccExpiryInput.addEventListener('keydown', ccExpiryInputKeyDownHandler);
ccExpiryInput.addEventListener('input', ccExpiryInputInputHandler);
</script>

<script>
  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (function() {
    'use strict';

    window.addEventListener('load', function() {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');

      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
</script>
</html>